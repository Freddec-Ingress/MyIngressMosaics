{% extends 'base.html' %}

{% block extra-head %}

	<title>MIM - Hunt</title>

	<meta property="og:url" content="https://www.myingressmosaics.com">
	<meta property="og:type" content="website">
	<meta property="og:title" content="MyIngressMosaics">
	<meta property="og:description" content="Ingress Mosaics, Banners and Mission series">

{% endblock %}

{% block content %}
<div id="content" ng-controller="NewRegistrationCtrl">

{% verbatim %}

	<div id="loading" ng-hide="loaded">
		<i class="item fa fa-spinner rotating"></i>
		<span class="item">Loading page...</span>
	</div>
	
	<div class="container" ng-class="{'active':loaded}">
	
		<div id="loading" ng-show="creating" class="mt-normal p-normal">
			<i class="item fa fa-spinner rotating"></i>
			<span class="item">Creating mosaic...</span>
		</div>
		
		<div class="modal-container" ng-if="mission_selected">
			<div class="modal-box" style="width:207px;">
				
				<div class="modal-header">
					
					<span class="title">
						Mission order
					</span>
					
					<span class="close" ng-click="closeOrder();">
						<i class="fa fa-times"></i>
					</span>
					
				</div>
				
				<div class="modal-content">
					
					<div class="row">
						
						<div class="item">
							<span class="color-light">{{mission_selected.title}}</span>
						</div>
						
					</div>
					
					<div class="row mb-big">
						
		            	<div class="item">
		            		<input type="text" class="control" ng-model="order" ng-init="order=mission_selected.order;">
		            	</div>
		            	
		            	<div class="item">
		            		<button class="btn" ng-click="saveOrder(order);">
		            			Save
		            		</button>
		            	</div>
		            	
					</div>
					
					<div class="row">
						
		            	<div class="item">
		            		<a ng-click="retireMission(mission_selected);">
		            			Remove this mission
		            		</a>
		            	</div>
		            	
					</div>
					
				</div>
				
			</div>
		</div>
		
		<div class="grow flex-col" ng-show="user && current_step == 1 && !creating">
			
			<div ng-if="!user.authenticated" class="self-center">
			    
			    <div class="p-normal mt-big" style="max-width:300px;">
			    	
			    	<div class="col">
			    	
					    <div class="item text-center">
						    To register mosaics you have to sign in.
					    </div>

				    	<div class="item flex justify-center">
				    		<a class="btn" href="/login">
				    			Sign in
				    		</a>
				    	</div>

					</div>
					
				</div>
				
			</div>			
			
			<div class="grow flex-col" ng-if="user.authenticated">
				
				<div class="p-normal pr-xl-none pl-xl-none">
					
					<form class="row">
						
						<div class="item grow">
							<input class="control" placeholder="Mission name, creator" ng-model="searchText" />
						</div>
						
						<div class="item">
							<button class="btn" type="submit" ng-click="refreshMissions(searchText);">
								<i class="fa fa-refresh"></i>
							</button>
						</div>
						
					</form>
					
				</div>
				
				<hr ng-if="missions.length > 0">
					
				<div class="scrollable">
					
					<div ng-if="refreshing" class="mt-normal flex align-center justify-center">
						<i class="item fa fa-spinner rotating"></i>
						<span class="item">Refreshing...</span>
					</div>
					
					<div ng-if="!refreshing">
						
	                    <div ng-if="missions.length < 1">
	                    	
	                    	<div class="text-center mt-normal mb-normal">
	                    		<span class="color-muted">No mission</span>
	                    	</div>
	                    	
	                    	<div class="flex align-center justify-center">
	                    		
	                    		<div class="p-normal text-center" style="width:300px;">
	                    			<div class="mb-normal">To register missions by yourself, click here</div>
	                    			<a href="/recruitment">How to become a mosaic hunter?</a>
	                    		</div>
	                    		
	                    	</div>
	                    	
	                    </div>
	                    
	                    <div ng-repeat="mission in missions">
	                    	
	                    	<div class="p-normal" ng-class="{'bgcolor-highlight':mission.selected}">
		                    	<div class="row align-center nowrap">
	
					                <a class="item" ng-click="toggleSelectMission(mission);">
					        			<img src="/static/img/mask.png" style="width:26px; background-color:#000000; background-image:url({{mission.image}}=s25); background-size: 95% 95%; background-position: 50% 50%; float:left; background-repeat: no-repeat;" />
			                    	</a>
			                    	
			                    	<a class="item grow ellipsis" title="{{mission.desc}}" ng-click="toggleSelectMission(mission);">
			                    		
			                    		<div class="ellipsis">
				                    		<span class="color-light">{{mission.title}}</span>
			                    		</div>
			                    		
			                    		<div class="">
				                    		<span ng-class="{'color-enlightened': mission.faction == 'E', 'color-resistant': mission.faction == 'R'}">{{mission.creator}}</span>
			                    		</div>
			                    		
			                    	</a>
	
			                    	<div class="item">
		                                <a class="btn btn-icon" href="https://www.ingress.com/intel?ll={{mission.startLat}},{{mission.startLng}}&z=17&pll={{mission.startLat}},{{mission.startLng}}" target="blank">
		                                    <i class="fa fa-external-link"></i>
		                                </a>
			                    	</div>
			                    	
		                    	</div>
	                    	</div>
	                    	
	                    	<hr>
	                    	
	                    </div>
	                    
					</div>
					
				</div>
				
				<hr>
				
				<div class="p-normal">
					<div class="row">
						
						<div class="item grow flex">
							
							<div class="text-center ml-normal">
								
								<div>
									<a ng-click="selectAll();">
										Select All ({{missions.length}})
									</a>
								</div>
								
							</div>
							
						</div>
						
						<div class="item self-center">
							<button class="btn" ng-class="{'disabled':selected.length < 3}" ng-click="open_step(2);" ng-disabled="selected.length < 3">
								<div class="row">
									<span class="item">({{selected.length}}) Next</span>
									<i class="item fa fa-angle-double-right"></i>
								</div>
							</button>
						</div>
						
					</div>
				</div>
				
			</div>			
			
		</div>
		
		<div class="grow flex-col" ng-show="current_step == 2 && !creating">
			
			<div class="flex justify-center">
				<div class="flex wrap">
					<div class="p-normal">
						<div class="row">
							
							<div class="item self-center text-right" style="min-width:150px; width:150px;">
								Number of columns
							</div>
							
							<div class="item">
								<select class="control" ng-model="columns" ng-change="computeOffset();">
									<option value="6">6</option>
									<option value="5">5</option>
									<option value="4">4</option>
									<option value="3">3</option>
									<option value="2">2</option>
									<option value="1">1</option>
								</select>
							</div>
							
						</div>
					</div>
					
					<div class="p-normal">
						<div class="row">
							
							<div class="item self-center text-right" style="min-width:150px; width:150px;">
								For missing missions, indicate here order
							</div>
							
							<div class="item" style="min-width:64px; width:64px;">
								<input type="text" class="control" ng-model="fakeorder" />
							</div>
							
							<div class="item">
								<button class="btn" ng-click="addFake(fakeorder);">
									Add
								</button>
							</div>
							
						</div>
					</div>
				</div>
			</div>
			
			<div class="flex justify-center">
				
				<div class="item">
					<a ng-click="reorderAsc();">Order Asc</a>
				</div>
				
				<div class="item">
					<a ng-click="reorderDesc();">Order Desc</a>
				</div>
				
			</div>
			
			<hr>
			
			<div class="scrollable flex p-normal align-start">
				
				<a class="flex grow wrap justify-center" style="padding:0 calc((6 - {{columns}}) / 2 * 16.666667%);">
					
		            <div ng-repeat="m in offset track by $index" style="flex:0 0 calc(100% / {{columns}});">
		            </div>
		            
		            <div ng-repeat="mission in selected | reverse" class="mission-vignet" style="flex:0 0 calc(100% / {{columns}});" ng-click="displayOrder(mission);">
		                <img src="/static/img/mask.png" style="width:100%; background-color:#000000; background-image:url({{mission.image}}=s100); background-size: 95% 95%; background-position: 50% 50%; float:left; background-repeat: no-repeat;" />
		                <div class="text-center">
		                	<a>{{mission.order}}</a>
		                </div>
		            </div>
		            
	            </a>
			
			</div>
			
			<hr>
			
			<div class="p-normal">
				<div class="row">
					
					<div class="item grow flex">
						<button class="btn" ng-click="open_step(1);">
							<div class="row">
								<i class="item fa fa-angle-double-left"></i>
								<span class="item">Back</span>
							</div>
						</button>
					</div>
					
					<div class="item self-center">
						<button class="btn" ng-click="open_step(3);">
							<div class="row">
								<span class="item">Next</span>
								<i class="item fa fa-angle-double-right"></i>
							</div>
						</button>
					</div>
					
				</div>
			</div>
			
		</div>
		
		<div class="grow flex-col" ng-show="current_step == 3 && !creating">
			
			<div class="grow col p-normal">
			
				<div class="item flex-col">
					<span>Mosaic name</span>
					<input type="text" class="control" ng-model="mosaic_name" />
				</div>
			
				<div class="item flex-col">
					<span>Mosaic type</span>
					<select class="control" ng-model="mosaic_type">
						<option value="sequence">sequence</option>
						<option value="serie">serie</option>
					</select>
				</div>
			
				<div class="item flex-col">
					<span>Country</span>
					<input type="text" class="control" ng-model="country_name" />
				</div>
			
				<div class="item flex-col">
					<span>Region</span>
					<input type="text" class="control" ng-model="region_name" />
				</div>
			
				<div class="item flex-col">
					<span>City</span>
					<input type="text" class="control" ng-model="city_name" />
				</div>
			
			</div>
			
			<hr>
			
			<div class="p-normal">
				<div class="row">
					
					<div class="item grow flex">
						<button class="btn" ng-click="open_step(2);">
							<div class="row">
								<i class="item fa fa-angle-double-left"></i>
								<span class="item">Back</span>
							</div>
						</button>
					</div>
					
					<div class="item self-center">
						<button class="btn" ng-click="open_step(4);" ng-disabled="!mosaic_name || !mosaic_type || !country_name || !region_name || !city_name">
							<div class="row">
								<span class="item">Next</span>
								<i class="item fa fa-angle-double-right"></i>
							</div>
						</button>
					</div>
					
				</div>
			</div>
			
		</div>
		
		<div class="grow flex-col" ng-show="current_step == 4 && !creating">
			
			<div class="grow col p-normal">
				
				<div class="item text-center pb-none">
					<span class="text-big color-light">{{mosaic_name}}</span>
				</div>
				
				<div class="item flex-col pt-none">
					
					<div class="flex justify-center">
						<flag class="item" country="country_name"></flag>
						<span class="item">{{city_name}}, {{region_name}}</span>
					</div>
						
					<div class="item text-center">
						<span>{{selected.length}} missions</span>
						<span ng-show="mosaic_type=='sequence'">&nbsp;in sequence</span>
						<span ng-show="mosaic_type=='serie'">&nbsp;in serie</span>
					</div>

				</div>
				
				<hr>
				
				<div class="scrollable flex align-start p-normal">
					
					<div class="flex grow wrap justify-center" style="padding:0 calc((6 - {{columns}}) / 2 * 16.666667%);">
						
			            <div ng-repeat="m in offset track by $index" style="flex:0 0 calc(100% / {{columns}});">
			            </div>
			            
			            <div ng-repeat="mission in selected | reverse" class="mission-vignet" style="flex:0 0 calc(100% / {{columns}});" ng-click="displayOrder(mission);">
			                <img src="/static/img/mask.png" style="width:100%; background-color:#000000; background-image:url({{mission.image}}=s100); background-size: 95% 95%; background-position: 50% 50%; float:left; background-repeat: no-repeat;" />
			            </div>
			            
		            </div>
				
				</div>
					
			</div>
			
			<hr>
			
			<div class="p-normal">
				<div class="row">
					
					<div class="item grow flex">
						<button class="btn" ng-click="open_step(3);">
							<div class="row">
								<i class="item fa fa-angle-double-left"></i>
								<span class="item">Back</span>
							</div>
						</button>
					</div>
					
					<div class="item self-center">
						<button class="btn btn-danger" ng-click="createMosaic();">
							<div class="row">
								<span class="item">Validate</span>
							</div>
						</button>
					</div>
					
				</div>
			</div>
			
		</div>
			
	</div>
			
{% endverbatim %}

</div>
{% endblock %}